<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Face Detection</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  
  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7/dist/blazeface.min.js"></script>
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <h1 class="logo">AI Detection</h1>
      <div class="header-actions">
        <button class="menu-btn" id="menuBtn">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <!-- Video Container -->
    <div class="video-section">
      <div class="video-container">
        <video id="video" playsinline autoplay muted></video>
        <canvas id="detectionOverlay"></canvas>
        <canvas id="capture" style="display: none;"></canvas>
        
        <!-- Auto-start Overlay -->
        <div class="auto-start-overlay" id="autoStartOverlay">
          <div class="auto-start-content"> 

            <div class="countdown" id="countdown">5</div>
            <h3>Câmera será ativada automaticamente</h3>
            <button class="btn-primary" id="startNowBtn">Ativar Agora</button>
            <button class="btn-secondary" id="cancelAutoBtn">Cancelar</button>
          </div>
        </div>

        <!-- Camera Permission -->
        <div class="camera-permission" id="cameraPermission" style="display: none;">
          <div class="permission-content">
            <h3>Permitir acesso à câmera?</h3>
            <p>Necessário para detecção facial</p>
            <div class="permission-actions">
              <button class="btn-primary" id="allowCameraBtn">Permitir</button>
              <label class="remember-choice">
                <input type="checkbox" id="rememberChoice"> Lembrar escolha
              </label>
            </div>
          </div>
        </div>

        <!-- Loading -->
        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
          <div class="loading-content">
            <div class="loading-spinner"></div>
            <p id="loadingText">Carregando modelos IA...</p>
          </div>
        </div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="control-btn" id="toggleBtn">
          <span class="btn-text">Iniciar</span>
        </button>
        <button class="control-btn secondary" id="captureBtn" disabled>
          <span class="btn-text">Capturar</span>
        </button>
        <!-- Debug button -->
        <button class="control-btn secondary" id="debugBtn" style="display: none;">
          <span class="btn-text">Debug Stop</span>
        </button>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-section">
      <div class="stat-card">
        <div class="stat-value" id="personCount">0</div>
        <div class="stat-label">Pessoas</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="faceCount">0</div>
        <div class="stat-label">Rostos</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalDetections">0</div>
        <div class="stat-label">Total</div>
      </div>
    </div>

    <!-- Quick Settings -->
    <div class="quick-settings">
      <div class="setting-item">
        <span class="setting-label">Desenhar Elemento</span>
        <label class="toggle">
          <input type="checkbox" id="drawBoxes" checked>
          <span class="slider"></span>
        </label>
      </div>
      <div class="setting-item">
        <span class="setting-label">Enviar Captura</span>
        <label class="toggle">
          <input type="checkbox" id="captureEnabled" checked>
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </main>

  <!-- Side Menu -->
  <div class="side-menu" id="sideMenu">
    <div class="menu-header">
      <h2>Configurações</h2>
      <button class="close-menu" id="closeMenu">×</button>
    </div>
    
    <div class="menu-content">
      <!-- Webhook Settings -->
      <div class="menu-section">
        <h3>Webhook</h3>
        <div class="input-group">
          <label>URL do Webhook</label>
          <input type="url" id="webhookUrl" value="https://workflow.blazysoftware.com.br/webhook/pego-no-pulo">
        </div>
        <div class="input-group">
          <label>Telefone (WhatsApp)</label>
          <input type="tel" id="phoneInput" placeholder="+55 62 98116 66035" inputmode="tel" />
          <small class="input-help">Formato: +55 62 98333 6333 — será exigido para ativar a câmera</small>
        </div>
        <button class="btn-secondary full-width" id="testWebhook">Testar Conexão</button>
        <div class="status-text" id="webhookStatus">Não configurado</div>
      </div>

      <!-- Detection Settings -->
      <div class="menu-section">
        <h3>Detecção</h3>
        
        <div class="range-group">
          <label>Sensibilidade Pessoas</label>
          <input type="range" id="confidence" min="0" max="1" step="0.05" value="0.6">
          <span class="range-value" id="confidenceValue">60%</span>
        </div>

        <div class="range-group">
          <label>Sensibilidade Rostos</label>
          <input type="range" id="faceConfidence" min="0" max="1" step="0.05" value="0.7">
          <span class="range-value" id="faceConfidenceValue">70%</span>
        </div>

        <div class="range-group">
          <label>Intervalo de Alertas</label>
          <input type="range" id="cooldown" min="0" max="60" value="5">
          <span class="range-value" id="cooldownValue">5s</span>
        </div>

        <div class="range-group">
          <label>Performance (FPS)</label>
          <input type="range" id="performance" min="1" max="30" value="5">
          <span class="range-value" id="performanceValue">5 FPS (Mobile)</span>
        </div>

        <div class="range-group">
          <label>Delay Captura (Frames para Frente)</label>
          <input type="range" id="captureDelay" min="0" max="8" value="3">
          <span class="range-value" id="captureDelayValue">3 frames (~600ms)</span>
        </div>
      </div>

      <!-- System Info -->
      <div class="menu-section">
        <h3>Sistema</h3>
        <div class="info-item">
          <span>Status da Câmera</span>
          <span class="status-badge" id="cameraStatus">Offline</span>
        </div>
        <div class="info-item">
          <span>Modelo Pessoas</span>
          <span class="status-badge" id="modelStatus">Carregando</span>
        </div>
        <div class="info-item">
          <span>Modelo Faces</span>
          <span class="status-badge" id="faceModelStatus">Carregando</span>
        </div>
        <div class="info-item">
          <span>Último Envio</span>
          <span class="status-text" id="lastSend">Nunca</span>
        </div>
      </div>

      <!-- Theme Settings -->
      <div class="menu-section">
        <h3>Aparência</h3>
        <div class="setting-item">
          <span class="setting-label">Tema Escuro</span>
          <label class="toggle">
            <input type="checkbox" id="darkModeToggle">
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <!-- Actions -->
      <div class="menu-section">
        <h3>Ações</h3>
        <button class="btn-secondary full-width" id="clearCache">Limpar Cache</button>
        <button class="btn-secondary full-width" id="modelInfo">Info dos Modelos</button>
      </div>
    </div>
  </div>

  <!-- Overlay -->
  <div class="overlay" id="overlay"></div>

  <!-- Toast Notifications -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="app.js"></script>
</body>
</html>